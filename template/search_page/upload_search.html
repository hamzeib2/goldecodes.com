{% load static %}

<!DOCTYPE html>
<html lang="en">

<head>
    <!-- google font -->
    <link rel="preconnect" href="https://fonts.googleapis.com">
    <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
    <link href="https://fonts.googleapis.com/css2?family=Poppins:wght@200&display=swap" rel="stylesheet">
    
    <!-- <link href="{% static 'font/OfficinaSansStd-Bold.otf' %}" rel="stylesheet"> -->
    <!--  -->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" type="text/css" href="http://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script type="module" src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.esm.js"></script>
    <script nomodule src="https://unpkg.com/ionicons@7.1.0/dist/ionicons/ionicons.js"></script>
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/4.7.0/css/font-awesome.min.css">
	
	<link rel="stylesheet" type="text/css" href="http://stackpath.bootstrapcdn.com/font-awesome/4.7.0/css/font-awesome.min.css">
    <script src="https://ajax.googleapis.com/ajax/libs/jquery/3.6.0/jquery.min.js"></script>
    <meta charset="UTF-8">
    <meta http-equiv="X-UA-Compatible" content="IE=edge">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <link rel="icon" href="/static/img/logo.jpg" />
    <title>Online Shopping site</title>

    <!--css file-->
    <link rel="stylesheet" href="{% static 'css/slide.css' %}" />
    <link rel="stylesheet" href="{% static 'css/card-product.css' %}" />
    
    <link rel="stylesheet" href="{% static 'css/mainpagee2.css' %}">
    <link rel="stylesheet" href="https://cdn.jsdelivr.net/npm/swiper@9/swiper-bundle.min.css" >
    <link href=" https://cdn.jsdelivr.net/npm/swiper@9.1.0/swiper-bundle.min.css " rel="stylesheet">
    <script src="https://www.w3schools.com/js/myScript.js"></script>
    <script type="text/javascript" src="{% static 'js/mainpage.js' %}"></script>
    <script type="text/javascript" src="{% static 'js/cart.js' %}"></script>
    
    <!--font awesome-->
    <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.2.0/css/all.min.css"
        integrity="sha512-xh6O/CkQoPOWDdYTDqeRdPCVd1SpvCA9XXcUnZS2FmJNp1coAFzvtCN9BmamE+4aHK8yyUHUSCcJHgXloTyT2A=="
        crossorigin="anonymous" referrerpolicy="no-referrer" />

</head>

<body>
    <header class="header">
        <div class="container container-header">
            <div class="logo-container border-white">
                <div class="logo">
                    <img src="/static/img/logo.jpg" alt=""style= "width:200px; max-height:100px; position:relative; top:-34px;">
                </div>
            </div>

           
            <div class="search-container">
                <div class="row">
                    <input type="text" id="input-box" class="search-input" placeholder="Search in Products"  autocomplete="off">
                    <div class="search-icon">
                    <i class="fa-solid fa-magnifying-glass"></i>
                    </div>
                </div>
                <div class="result-box">
                    
                </div>
            </div>









            <!-- <div class="balance-container">
                <p>Balance :
                <div class="Bouns">100</div>
                </p>
            </div> -->

           

            <div class="cart-container border-white">
                <a href="{% url 'cart' %}">
                <i class="fa-solid fa-cart-shopping"></i>
                {{cartItems}} Cart  </a>
            </div>
        </div>
    </header>

    <!--navigation-->
    <nav class="nav">
        <div class="container container-nav">
            <ul>
                
                <li class="border-white"><a href="{% url 'store' %}">Main Store</a></li>
                <li class="border-white "><a  href="{% url 'Amazon' %}"><span id="mobile">Amazon</span></a></li>
                <li class="border-white "><a id="" href="{% url 'Itunes' %}">Itunes</a></li>
                <li class="border-white "><a id="" href="{% url 'Razer_Gold' %}"><span id="electronic">Razer-Gold</span></a></li>
                <li class="border-white "><a id="" href="{% url 'Master_Card' %}"><span id="home"> Master-Card</span></a></li>
                <li class="border-white "><a id="" href="{% url 'Walmart' %}"><span id="fashion">Walmart</span></a></li>
                <li class="border-white "><a id="" href="{% url 'Uber' %}"><span id="book">Uber</span></a></li>
                <li class="border-white "><a id="" href="{% url 'XBOX' %}">XBOX</a></li>
                <li class="border-white "><a id="" href="{% url 'FreeFire' %}">FreeFire</a></li>
            </ul>
        </div>
    </nav>
    <!--Sidebar products-->
    <div class="pro_slidebar-container" id="pro_sliderbar-container">
        <div class="pro_slidebar-content">
            <div class="pro_slidebar-top">
                
            </div>
            <div class="pro_slidebar-wrapper">
                <div class="pro_slidebar-item">
                    <h2>About It :</h2>
                    <p><a href="" id="name">name:</a></p>
                    <p><a href="" id="amount_in">amount in: </a></p>
                    <p><a href="" id="views">views:</a></p>
                </div>
                <div class="pro_slidebar-item">
                    <h2>Description :</h2>
                    <p><a href="" id="des_short">short:</a></p>
                    <p><a href="" id="des_tall">tall:</a></p>
                    <p><a href="" id=""></a></p>
                </div>
                <div class="pro_slidebar-item">
                    <h2>More Info :</h2>
                    <p><a href="" id="category">Category:</a></p>
                    <p><a href="" id="price">Price:</a></p> 
                    
                </div>
                <div class="forbtn" id="forbtn">
                    <button>Add</button>
                   
                </div>
               
               
            </div>
        </div>
        <!--
        <button id="pro_slidebar-container-close" onclick="hide_slide()">
            <i class="fa-solid fa-xmark"></i>
        </button>-->
        
    </div>

    <div class="pro_container">

        <div class="pro_box-container" id="all_search">
        </div>
    </div>

<script>
      let data
           function LoadDATA(){
            $.ajax({
                type:'GET',
                url:"{% url 'getproducts' %}",
                success:  function(response){
                    data = response
                    generateCartItems(data)
                    getname(data)
                        }
                    })
                        
                   }
                  
        
        LoadDATA()

        function get_index(pro ){
        
        index =  data.products.findIndex((el) => el.id === pro.id)
        return index
        }

        function get_image(pro){
        img = (pro.image)
        return img

    }
    function get_extra_photo(pro){
        imgp = (pro.extra_photo)
        return imgp

    }
    function get_extra_img(pro){
        imgx = (pro.extra_img)
        return imgx

    }

        let generateCartItems = (basket) => {
    if (basket.length !== 0) {
       (all_search.innerHTML = basket.products
        .map((x) => {
          let { id, item } = x;
          let search = data.products.find((y) => y.id === id) || [];
          index = get_index(search)
          var img = get_image(search)
            count = index + 1
            image = img
          return `
          <div class="card swiper-slide">
                    <div class="image-con">
                        <span class="overr"><span class="inter"><span class="offer" style="font-size: 1.1rem;font-weight: bold;">Dis <i class="fa fa-arrow-down" aria-hidden="true" style="font-size: 1.2rem;font-weight: bold;"></i> ${search.offer}%</span></span></span>
                        <span class="over"></span>
                        <div class="card-image">
                            <img src="/img/${image}" alt="" class="card-img">
                        </div>
                    </div>

                    <div class="card-content">
                        <h2 class="name">${search.name}</h2>
                        <p class="descrp">${search.short_desc}</p>
                        <div class="cfooter">
                            <button id="${search.id}" class="popbtn-close" data-product="${search.id}" data-action="add" onclick="set_id(this)" >Add To Cart</button>
                            <span class="pricee">Still In Storage ${search.quantity}</span>
                    </div>
                    </div>
                </div>
           
          `;
        })
        .join(""));
    } else {
      ShoppingCart.innerHTML = ``;
      label.innerHTML = `
      <h2>Cart is Empty</h2>
      <a href="index.html">
        <button class="HomeBtn">Back to home</button>
      </a>
      `;
    }
  };

function show_info(id){
    ID = parseInt(id)
            //let pro = []
    pro = data.products.find((x) => x.id === ID)
    img = get_image(pro)
    var imgp = get_extra_photo(pro)
    var imgx = get_extra_img(pro)
            imagep  = imgp
            imagex = imgx
            count = index + 1
            image = img
    $('#amount_in').empty()
    
    $('#amount_in').append(
        `<div class="imginfo" style="display: flex;justify-content: space-between;margin: 5% 10% 5% 0;">
        <img src="/img/${imagep}" alt="" class="card-img" height="100" width= "100">
        <img src="/img/${imagex}" alt="" class="card-img" height="100" width= "100">
        </div>`
    )
    $('#name').empty()
    $('#name').append(
        `<p>Name: ${pro.name}</p>`
    )
    $('#views').empty()
    $('#views').append(
        `<p>Views: ${pro.num_views}<i class="fa fa-eye"></i></p>`
    )
    $('#des_short').empty()
    $('#des_short').append(
        `<p>Description: ${pro.short_desc}</p>`
    )
    $('#des_tall').empty()
    $('#des_tall').append(
        `<p>${pro.tall_desc}</p>`
    )
    $('#category').empty()
    $('#category').append(
        `<p>Type: ${pro.category}</p>`
    )
    $('#price').empty()
    $('#price').append(
        `<p>Price: ${pro.price}syp</p>`
    )
    $('#forbtn').empty()
    $('#forbtn').append(
        `<button id="${pro.id}" class="popbtn-close " data-product="${pro.id}" data-action="add" onclick="set_id(this)">Add to Cart</button>
        `
    )
}
forbtn

category
 //let pro = []
 //pro = data.products.find((x) => x.id === ID)


 function set_id(ele){
        var user = '{{request.user}}'
        var prdid = ele.dataset.product// بملف التيمبليت منيجيب داتا معينة عن طريق الاسم يلي بعد كلمة داتا يلي بالتيمبلت ,هون جبنا الاي دي تبع كل منتج
        var action = ele.dataset.action//جبنا الاكشن يا اضافة يا حذف
        console.log('prdid:',prdid,'action',action)
        console.log('user:',user)

        if(user === 'AnonymousUser'){//اذا المستخدم مانو مسجل دخول
            addCookieItem(prdid , action)
        }

        else{
           updateuserorder(prdid , action)
        }
}

let kayword= []
function getname(data){
    for(let i in data.products){
        kayword[i] = data.products[i].name
    }
    console.log(kayword)
    return kayword
}

let resultbox = document.querySelector('.result-box');
let inputbox = document.querySelector('.search-input') || '';


inputbox.onkeyup = function(){
  let Farray = []
  let result = [];
  let input = inputbox.value;
  if(input.length){
      result = kayword.filter((key) => {
         return key.toLowerCase().includes(input.toLowerCase());
      });
      console.log(result)
      // Filter product ---> result
     localStorage.setItem('search', JSON.stringify(result))
     Farray = JSON.parse(localStorage.getItem('search'))
      console.log(Farray)

  }
  display(result);

  if(!result.length){
      resultbox.innerHTML = '';
  }
}

function display(result){
  const content= result.map((list) =>{
      return `<li class="li" onclick = slectedinput(this)>${list}</li>`;
  })
  resultbox.innerHTML = "<ul>" + content.join("") +"</ul>";
}
//"<a herf=search.html>"+ "</a>"
// =====>>>>>> join('') ===>>>>main select a element form array in sub  string 

function slectedinput(list){
 inputbox.value = list.innerHTML;
 resultbox.innerHTML = '';
 //inputbox.onkeyup()
 
}


filter_product = []
  let GetResultSearch = () =>{
      let filter_product = [];
      let items = JSON.parse(localStorage.getItem('search'))
      for(let i =0; i<items.length; i++){
        filter_product.push(products.find((x) => x.name === items[i]));
      }
      generateCartItems(filter_product);
  }
  
  (function fd(){
    const searchbox = document.querySelector('#input-box')
    
    Farray = []
    searchbox.addEventListener('keyup' , (e) => {
        const storeItems = document.querySelectorAll('.name')
        const searchfilter = e.target.value.toLowerCase().trim()
        console.log(storeItems)
        storeItems.forEach((item) => {
            if(item.textContent.includes(searchfilter)){
                item.parentElement.parentElement.style.display ='block'
            }else{
                item.parentElement.parentElement.style.display = 'none'
            }
        })
    })
})();

</script>
<script type="text/javascript" src="{% static 'js/cart.js' %}"></script>
</body>
</html>